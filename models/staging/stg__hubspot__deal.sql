select 
    deal.deal_id,
    deal_contact.contact_id,
    deal.property_dealname as deal_name,
    deal.PROPERTY_CREATEDATE AS deaL_created_date,
    row_number() over (partition by deal_contact.contact_id order by deal.PROPERTY_CREATEDATE) as deal_sequence,
    deal.property_hs_v_2_date_exited_174666285 as date_exited_opportunities_unengaged,
    deal.property_hs_v_2_date_entered_174666285 as date_entered_opportunities_unengaged,
    deal.property_hs_v_2_cumulative_time_in_174666285 as cumulative_time_in_opportunities_unengaged,
    deal.property_hs_v_2_latest_time_in_174666285 as latest_time_in_opportunities_unengaged,
    -- deal.property_hs_v_2_cumulative_time_in_220335375 as cumulative_time_in_leads_in_progress,
    -- deal.property_hs_v_2_date_entered_220335375 as date_entered_leads_in_progress,
    -- deal.property_hs_v_2_date_exited_220335375 as date_exited_leads_in_progress,
    deal.property_hs_v_2_latest_time_in_220335375 as latest_time_in_leads_in_progress,
    deal.property_hs_v_2_cumulative_time_in_174666286 as cumulative_time_in_match_in_progress,
    deal.property_hs_v_2_date_entered_174666286 as date_entered_match_in_progress,
    deal.property_hs_v_2_date_exited_174666286 as date_exited_match_in_progress,
    deal.property_hs_v_2_latest_time_in_174666286 as latest_time_in_match_in_progress,
    deal.property_hs_v_2_cumulative_time_in_174666287 as cumulative_time_in_match_shared,
    deal.property_hs_v_2_date_entered_174666287 as date_entered_match_me,
    deal.property_hs_v_2_date_exited_174666287 as date_exited_match_me,
    deal.property_hs_v_2_latest_time_in_174666287 as latest_time_in_match_shared,
    deal.property_hs_v_2_date_entered_1030520626 as date_entered_eval_booked,
    deal.property_hs_v_2_date_exited_1030520626 as date_exited_eval_booked,
    deal.property_hs_date_entered_1030520627 as date_entered_eval_complete, 
    deal.property_hs_date_exited_1030520627 as date_exited_eval_complete,
    deal.property_hs_v_2_date_entered_219182604 as date_entered_match_pending,
    deal.property_hs_v_2_date_exited_219182604 as date_exited_match_pending,
    deal.property_hs_v_2_latest_time_in_219182604 as latest_time_in_match_pending,
    deal.property_hs_v_2_cumulative_time_in_174666288 as cumulative_time_in_ongoing_sessions_scheduled,
    deal.property_hs_v_2_date_entered_174666288 as date_entered_ongoing_sessions_scheduled,
    deal.property_hs_v_2_date_exited_174666288 as date_exited_ongoing_sessions_scheduled,
    deal.property_hs_v_2_latest_time_in_174666288 as latest_time_in_ongoing_sessions_scheduled,
    deal.property_hs_v_2_cumulative_time_in_174666291 as cumulative_time_in_closed_lost,
    deal.property_hs_v_2_date_entered_174666291 as date_entered_closed_lost,
    deal.property_hs_v_2_date_exited_174666291 as date_exited_closed_lost,
    deal.property_hs_v_2_latest_time_in_174666291 as latest_time_in_closed_lost,
    deal.property_hs_v_2_date_entered_1030520628 AS date_entered_closed_lost_ongoing_treatment_not_recommended,
    deal.property_hs_v_2_date_exited_1030520628 AS date_exited_closed_lost_ongoing_treatment_not_recommended,
    deal.property_closed_loss_families as closed_lost_families_reason, 
    deal.property_closed_lost_reason as closed_lost_families_reason_deprecated,
    deal.PROPERTY_HS_DATE_EXITED_1022614567 as date_exited_lead_magnet_provider_recruiting,
    deal.PROPERTY_HS_DATE_ENTERED_1022614567 AS date_entered_lead_magnet_provider_recruiting, 
    -- New fields from CSV
    deal.property_hs_v_2_date_entered_245897332 as date_entered_referrals_provider_recruiting,
    deal.property_hs_v_2_date_exited_245897332 as date_exited_referrals_provider_recruiting,
    deal.property_hs_v_2_date_entered_181514531 as date_entered_new_provider_lead_provider_recruiting,
    deal.property_hs_v_2_date_exited_181514531 as date_exited_new_provider_lead_provider_recruiting,
    deal.property_hs_v_2_date_entered_181514532 as date_entered_interview_booked_provider_recruiting,
    deal.property_hs_v_2_date_exited_181514532 as date_exited_interview_booked_provider_recruiting,
    deal.property_hs_v_2_date_entered_181514533 as date_entered_post_interview_provider_recruiting,
    deal.property_hs_v_2_date_exited_181514533 as date_exited_post_interview_provider_recruiting,
    deal.property_hs_v_2_date_entered_181514534 as date_entered_clinical_interview_provider_recruiting,
    deal.property_hs_v_2_date_exited_181514534 as date_exited_clinical_interview_provider_recruiting,
    deal.property_hs_v_2_date_entered_181514535 as date_entered_offer_letter_provider_recruiting,
    deal.property_hs_v_2_date_exited_181514535 as date_exited_offer_letter_provider_recruiting,
    deal.property_hs_v_2_date_entered_181514537 as date_entered_recruitment_complete_provider_recruiting,
    deal.property_hs_v_2_date_exited_181514537 as date_exited_recruitment_complete_provider_recruiting,
    deal.property_hs_v_2_date_entered_181529889 as date_entered_cold_provider_recruiting,
    deal.property_hs_v_2_date_exited_181529889 as date_exited_cold_provider_recruiting,
    deal.property_hs_v_2_date_entered_181529890 as date_entered_closed_lost_provider_recruiting,
    deal.property_hs_v_2_date_exited_181529890 as date_exited_closed_lost_provider_recruiting,
    deal.property_hs_v_2_date_entered_181529891 as date_entered_disqualified_provider_recruiting,
    deal.property_hs_v_2_date_exited_181529891 as date_exited_disqualified_provider_recruiting,
    deal.PROPERTY_HS_V_2_DATE_ENTERED_1036779924 as date_entered_pending_tasks_provider_recruiting, 
    deal.PROPERTY_HS_V_2_DATE_EXITED_1036779924 as date_exited_pending_tasks_provider_recruiting, 
    deal.property_hs_v_2_date_entered_1036779925 as date_entered_onboarding_call_provider_recruiting, 
    deal.property_hs_v_2_date_exited_1036779925 as date_exited_onboarding_call_provider_recruiting, 
    deal.property_hs_v_2_date_entered_1036779923 as date_entered_pre_launch_provider_recruiting, 
    deal.property_hs_v_2_date_exited_1036779923 as date_exited_pre_launch_provider_recruiting,
    deal.property_hs_v_2_date_entered_990505850 as date_entered_pre_launch_provider_onboarding,
    deal.property_hs_v_2_date_exited_990505850 as date_exited_pre_launch_provider_onboarding,
    deal.property_hs_v_2_date_entered_200291858 as date_entered_ready_to_onboard_provider_onboarding,
    deal.property_hs_v_2_date_exited_200291858 as date_exited_ready_to_onboard_provider_onboarding,
    deal.property_hs_v_2_date_entered_200291859 as date_entered_pending_onboarding_tasks_provider_onboarding,
    deal.property_hs_v_2_date_exited_200291859 as date_exited_pending_onboarding_tasks_provider_onboarding,
    deal.property_hs_v_2_date_entered_200291860 as date_entered_schedule_onboarding_call_provider_onboarding,
    deal.property_hs_v_2_date_exited_200291860 as date_exited_schedule_onboarding_call_provider_onboarding,
    deal.property_hs_v_2_date_entered_200291863 as date_entered_onboarding_complete_provider_onboarding,
    deal.property_hs_v_2_date_exited_200291863 as date_exited_onboarding_complete_provider_onboarding,
    deal.PROPERTY_HS_DATE_ENTERED_260841100 as date_entered_checkr_fail_provider_onboarding,
    deal.PROPERTY_HS_DATE_EXITED_260841100 as date_exited_checkr_fail_provider_onboarding,
    deal.property_hs_v_2_date_entered_200291861 as date_entered_hold_provider_onboarding,
    deal.property_hs_v_2_date_exited_200291861 as date_exited_hold_provider_onboarding,
    deal.property_hs_v_2_date_entered_200291861 as date_entered_cold_provider_onboarding,
    deal.property_hs_v_2_date_exited_200291861 as date_exited_cold_provider_onboarding,
    deal.property_hs_v_2_date_entered_200291864 as date_entered_closed_lost_provider_onboarding,
    deal.property_hs_v_2_date_exited_200291864 as date_exited_closed_lost_provider_onboarding,
    deal.property_closed_loss_tag as closed_lost_provider_reason,
    deal.property_hs_v_2_date_entered_202963371 as date_entered_disqualified_provider_onboarding,
    --deal.property_hs_v2_date_entered_202963371 as date_entered_disqualified_provider_onboarding,
    --deal.property_hs_v_2_date_exited_202963371 as date_exited_disqualified_provider_onboarding,
    deal.property_hs_v_2_date_entered_183419161 as date_entered_new_school_lead,
    deal.property_hs_v_2_date_exited_183419161 as date_exited_new_school_lead,
    deal.property_hs_v_2_date_entered_183419162 as date_entered_call_scheduled,
    deal.property_hs_v_2_date_exited_183419162 as date_exited_call_scheduled,
    deal.property_hs_v_2_date_entered_183419165 as date_entered_call_completed,
    deal.property_hs_v_2_date_exited_183419165 as date_exited_call_completed,
    deal.property_hs_v_2_date_entered_183419166 as date_entered_provider_matching,
    deal.property_hs_v_2_date_exited_183419166 as date_exited_provider_matching,
    deal.property_hs_v_2_date_entered_183419167 as date_entered_screening_confirmed,
    deal.property_hs_v_2_date_exited_183419167 as date_exited_screening_confirmed,
    deal.property_hs_v_2_date_entered_221367334 as date_entered_screening_complete_won,
    deal.property_hs_v_2_date_entered_221367335 as date_entered_cold_school_pipeline,
    deal.property_hs_v_2_date_exited_221367335 as date_exited_cold_school_pipeline,
    deal.property_hs_v_2_date_entered_221360262 as date_entered_closed_lost_school_pipeline,
    deal.PROPERTY_HS_V_2_DATE_ENTERED_1024449842 as date_entered_discovery_call_provider_sales, 
    deal.PROPERTY_HS_V_2_DATE_EXITED_1024449842 as date_exited_discovery_call_provider_sales,
    deal.PROPERTY_HS_V_2_DATE_ENTERED_1024449843 AS date_entered_clinical_interview_provider_sales, 
    deal.PROPERTY_HS_V_2_DATE_EXITED_1024449843 AS date_exited_clinical_interview_provider_sales,
    deal.property_hs_v_2_date_entered_1024449844 as date_entered_pending_tasks_provider_sales, 
    --THE BELOW FIELDS NEED TO BE ADDED ONCE THE PIPELINE IS FILLED 
   -- deal.property_hs_v_2_date_exited_1024449844 as date_exited_pending_tasks_provider_sales, 
   --deal.property_hs_v_2_date_entered_1024449845 as date_entered_offer_letter_provider_sales, 
   --deal.property_hs_v_2_date_exited_1024449845 as date_exited_offer_letter_provider_sales,
   --deal.property_hs_v_2_date_entered_1024449846 as date_entered_closed_won_provider_sales,
   --deal.property_hs_v_2_date_exited_1024449846 as date_exited_closed_won_provider_sales
    deal.PROPERTY_HS_V_2_DATE_ENTERED_1024449847 as date_entered_closed_lost_provider_sales
    ---deal.property_hs_v_2_date_exited_1024449847 as date_exited_closed_lost_provider_sales

    -- deal.property_hs_v_2_date_exited_202963371 as date_exited_disqualified_provider_onboarding --exited doesn't seem to exist
    --deal.*
from {{ source('hubspot', 'deal') }} deal 
left join {{ source('hubspot', 'deal_contact') }} deal_contact 
    on deal.deal_id = deal_contact.deal_id
where 
deal.is_deleted = FALSE
